import{DateUtils}from"./../utils/date-utils.js";import{createImageUploadHandler}from"./../utils/image-uploader.js";export function initForms(productsDB,renderAllProducts,calendar){const addFormProducts=document.getElementById("add-form"),nameProduct=document.getElementById("name-product"),categoryProduct=document.getElementById("category"),dateManufactureProduct=document.getElementById("date-manufacture"),dateInput=document.getElementById("end-date");if(DateUtils.setMinDate(dateInput),DateUtils.setMaxDate(dateManufactureProduct),!addFormProducts)return void console.error("Форма добавления не найдена");const previewElement=addFormProducts.querySelector(".image-preview"),downloadImageForm=createImageUploadHandler(previewElement);addFormProducts.addEventListener("click",downloadImageForm),addFormProducts.addEventListener("submit",async function(e){e.preventDefault();const imageUrl=addFormProducts.querySelector(".image-preview img")?addFormProducts.querySelector(".image-preview img").src:null;let product={id:Date.now(),name:nameProduct.value,productionDate:dateManufactureProduct.value||null,expiryDate:dateInput.value||null,shelfLife:(new Date(dateInput.value)-new Date(dateManufactureProduct.value))/864e5||null,category:categoryProduct.value,inArchive:!1,image:imageUrl,addedDate:(new Date).toISOString().split("T")[0]};await productsDB.addProduct(product),console.log(await productsDB.getAllProducts()),addFormProducts.querySelector(".image-preview").innerHTML="",renderAllProducts(),await calendar.update(),addFormProducts.reset()})}