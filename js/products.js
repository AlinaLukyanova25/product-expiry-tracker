import{calculateDateDifference,formatDateCard}from"./utils/date-utils.js";export const productCategoryTranslation={milk:"Молочка",cheese:"Сыры",sausage:"Колбаса",meat:"Курица/Мясо",fish:"Рыба","frozen-food":"Заморозка",fresh:"Фреш",preserves:"Консервы",eggs:"Яйца",bread:"Хлеб",cakes:"Торты/пирожные",sweets:"Кондитерка",groceries:"Бакалея",snacks:"Снеки","baby-food":"Детское",cooking:"Кулинария","tea-coffee":"Чай/кофе","non-alc":"Безалк.нап",alc:"Алкоголь","сosmetics":"Косметика"};function getDaysText(daysLeft){if((daysLeft=parseInt(daysLeft))<0)return"Просрочено";if(0===daysLeft)return"Истекает сегодня!";return`До конца: ${daysLeft} ${numeralize.pluralize(daysLeft,"день","дня","дней")}`}export function createProductCardComponent(card){const categoryDisplay=productCategoryTranslation[card.category]||card.category,daysLeft=calculateDateDifference(card.expiryDate);let daysText="number"==typeof daysLeft?getDaysText(daysLeft):"Установите дату";const percent=setWidthProgrssBar(card),expiryDate=formatDateCard(card.expiryDate)||"Не выбрано";return`\n      <button class="btn-remove section__btn-remove">&#128465;&#65039;</button>\n      <div class="image-preview" id="preview-${card.id}">\n        ${card.image?`<img src="${card.image}" alt="${card.name}">`:""}\n        </div>\n        <div class="section__item-content" style="width: 100%;">\n        \n        <div class="section__item-header">\n        <h3 class="card__title">${card.name}</h3>\n          <p>${daysText}</p>\n          <div class="progress section__item-progress">\n            <div class="progress__bar section__item-progress-bar" style="width: ${percent}"></div>\n          </div>\n        </div>\n        <div class="section__item-footer">\n          <div>До ${expiryDate}</div>\n          <div>${categoryDisplay}</div>\n        </div>\n        <div>\n    `}export function creaeteArchiveCardComponent(product){const categoryDisplay=productCategoryTranslation[product.category]||product.category;return`\n       <button class="btn-remove section__btn-remove">&#128465;&#65039;</button>\n        <div class="section__item-header" style="margin: 0;">\n        <h3 class="card__title">${product.name}</h3>\n          <p>Продукт в архиве</p>\n        </div>\n        <div class="section__item-footer"  style="justify-content: right;">\n          <div class="section__category--today" style="margin: 0;">${categoryDisplay}</div>\n        </div>\n    `}export async function renderInitialProducts(productsDB,filterSelect,sections){const products=await productsDB.getAllProducts();let arr=[];for(let prod of products)arr.push(prod);"date"===filterSelect.value&&(arr=arr.sort((a,b)=>new Date(a.expiryDate)-new Date(b.expiryDate))),"name"===filterSelect.value&&(arr=arr.sort((a,b)=>a.name.localeCompare(b.name)));for(let prod of arr)if(prod.inArchive)renderProductsToArchive(sections.archive,prod);else{renderProductsToSection(sections.all,prod);const daysLeft=calculateDateDifference(prod.expiryDate);renderProductsToSection(daysLeft<=3&&daysLeft>0?sections.soon:daysLeft<=0?sections.expired:sections.fresh,prod)}}export async function renderAllProducts(productsDB,filterSelect,sections){clearSections(sections),await renderInitialProducts(productsDB,filterSelect,sections)}export function renderProductsToSection(section,prod){const ul=section.querySelector("ul");"Пока ничего нет..."===ul.querySelector("p")?.textContent&&(ul.innerHTML="");let li=document.createElement("li");li.classList.add("card","section__item"),li.setAttribute("data-product-id",prod.id),li.setAttribute("tabindex","0"),li.innerHTML=createProductCardComponent(prod),ul.append(li),"all-products"===section.id&&new Date(prod.expiryDate)<new Date&&li.classList.add("shadow")}export function renderProductsToArchive(section,product){const ul=section.querySelector("ul");if(!ul)return;"Пока ничего нет..."===ul.querySelector("p")?.textContent&&(ul.innerHTML="");const li=document.createElement("li");li.classList.add("card","section__item"),li.setAttribute("data-product-id",product.id),li.setAttribute("tabindex","0"),li.innerHTML=creaeteArchiveCardComponent(product),ul.append(li)}function setWidthProgrssBar(product){const allTime=new Date(product.expiryDate)-new Date(product.productionDate);if(!allTime)return"0%";console.log(product,allTime/864e5);const remainingTime=new Date(product.expiryDate)-new Date;console.log(remainingTime/864e5);const subtractionPercent=100*(allTime-remainingTime)/allTime;return console.log(Math.round(subtractionPercent)),Math.round(subtractionPercent)>100||!subtractionPercent?"100%":Math.round(subtractionPercent)+"%"}function clearSections(sections){Object.values(sections).forEach(section=>{section.querySelector("ul").innerHTML="<p>Пока ничего нет...</p>"})}